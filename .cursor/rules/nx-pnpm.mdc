---
description: Nx Workspace management, pnpm dependency rules, and app scaffolding.
globs: ["nx.json", "pnpm-workspace.yaml", "package.json", "apps/**/*", "libs/**/*"]
---
# Nx + pnpm Workspace Standards (2025)

## 1. Package Management & Execution
- **Package Manager:** Use `pnpm` exclusively. Never suggest `npm`, `yarn`, or `npx`.
- **Command Execution:** Use `pnpm nx <target> <project>` (e.g., `pnpm nx build web-app`).
- **Binary Execution:** Use `pnpm exec nx ...` for local binaries to ensure the workspace version is used.
- **Dependencies:** 
  - Root: `pnpm add <pkg> -w`
  - Scoped: `pnpm add <pkg> --filter <project-name>`

## 2. App & Library Scaffolding (2025 Best Practice)
- **Frontend (Next.js):** Do NOT use `create-next-app`. Use the Nx generator:
  `pnpm nx g @nx/next:app apps/<app-name> --style=tailwind --appDir=true --src=true`
- **Backend (Nest.js):** Do NOT use `create-nest-app`. Use the Nx generator:
  `pnpm nx g @nx/nest:app apps/<app-name> --directory=apps/<app-name>`
- **Shared Logic:** Use libraries for logic and UI to maintain monorepo health:
  `pnpm nx g @nx/js:lib libs/<domain>/<name>`

## 3. Architecture & Pathing
- **Imports:** Use TypeScript path aliases (e.g., `@org/shared-ui`) from `tsconfig.base.json`. **Strictly forbid** relative paths across library or app boundaries (e.g., `../../libs/...`).
- **Project Boundaries:** Respect tags in `project.json`. Apps should be thin; business logic belongs in `libs/`.
- **Nx Caching:** Leverage pnpm's content-addressable store alongside Nx's local/remote cache for sub-second builds.

## 4. Configuration
- **Tailwind:** When adding a new app, ensure the root `tailwind.config.ts` includes all library paths in the `content` array to enable design token sharing.
- **TypeScript:** Ensure `tsconfig.base.json` is updated by the generator when new libraries are added.
